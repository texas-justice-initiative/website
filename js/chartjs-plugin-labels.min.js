/**
 * [chartjs-plugin-labels]{@link https://github.com/emn178/chartjs-plugin-labels}
 *
 * @version 1.0.1
 * @author Chen, Yi-Cyuan [emn178@gmail.com]
 * @copyright Chen, Yi-Cyuan 2017-2018
 * @license MIT
 */
(function(){function f(){this.renderToDataset=this.renderToDataset.bind(this)}if("undefined"===typeof Chart)console.error("Can not find Chart object.");else{var n=new Set(["pie","doughnut","polarArea"]);f.prototype.setup=function(a,c){this.chart=a;this.ctx=a.ctx;var b=a.config.options;this.options=Object.assign({position:"default",precision:0,fontSize:b.defaultFontSize,fontColor:b.defaultFontColor,fontStyle:b.defaultFontStyle,fontFamily:b.defaultFontFamily,shadowOffsetX:3,shadowOffsetY:3,shadowColor:"rgba(0,0,0,0.3)",
shadowBlur:6,images:[],outsidePadding:2,textMargin:2,overlap:!0},c)};f.prototype.render=function(){this.labelBounds=[];this.chart.data.datasets.forEach(this.renderToDataset)};f.prototype.renderToDataset=function(a){this.totalPercentage=0;this.total=null;this.elements.forEach(function(c,b){this.renderToElement(a,c,b)}.bind(this))};f.prototype.renderToElement=function(a,c,b){if(this.shouldRenderToElement(c._view)){this.percentage=null;var d=this.getLabel(a,c,b);if(d){var e=this.ctx;e.save();e.font=
Chart.helpers.fontString(this.options.fontSize,this.options.fontStyle,this.options.fontFamily);var g=this.getRenderInfo(c,d);this.drawable(c,d,g)&&(e.beginPath(),e.fillStyle=this.getFontColor(a,c,b),this.renderLabel(d,g));e.restore()}}};f.prototype.renderLabel=function(a,c){return this.options.arc?this.renderArcLabel(a,c):this.renderBaseLabel(a,c)};f.prototype.renderBaseLabel=function(a,c){var b=this.ctx;if("object"===typeof a)b.drawImage(a,c.x-a.width/2,c.y-a.height/2,a.width,a.height);else{b.save();
b.textBaseline="top";b.textAlign="center";this.options.textShadow&&(b.shadowOffsetX=this.options.shadowOffsetX,b.shadowOffsetY=this.options.shadowOffsetY,b.shadowColor=this.options.shadowColor,b.shadowBlur=this.options.shadowBlur);for(var d=a.split("\n"),e=0;e<d.length;e++)b.fillText(d[e],c.x,c.y-this.options.fontSize/2*d.length+this.options.fontSize*e);b.restore()}};f.prototype.renderArcLabel=function(a,c){var b=this.ctx,d=c.radius,e=c.view;b.save();b.translate(e.x,e.y);if("string"===typeof a){b.rotate(c.startAngle);
b.textBaseline="middle";b.textAlign="left";e=a.split("\n");var g=0,h=[],f=0;"border"===this.options.position&&(f=(e.length-1)*this.options.fontSize/2);for(var k=0;k<e.length;++k){var l=b.measureText(e[k]);l.width>g&&(g=l.width);h.push(l.width)}for(k=0;k<e.length;++k){var m=e[k],n=(e.length-1-k)*-this.options.fontSize+f;b.save();b.rotate((g-h[k])/2/d);for(var p=0;p<m.length;p++){var q=m.charAt(p);l=b.measureText(q);b.save();b.translate(0,-1*d);b.fillText(q,0,n);b.restore();b.rotate(l.width/d)}b.restore()}}else b.rotate((e.startAngle+
Math.PI/2+c.endAngle)/2),b.translate(0,-1*d),this.renderLabel(a,{x:0,y:0});b.restore()};f.prototype.shouldRenderToElement=function(a){return this.options.showZero||"polarArea"===this.chart.config.type?0!==a.outerRadius:0!==a.circumference};f.prototype.getLabel=function(a,c,b){if("function"===typeof this.options.render)a=this.options.render({label:this.chart.config.data.labels[b],value:a.data[b],percentage:this.getPercentage(a,c,b),dataset:a,index:b});else switch(this.options.render){case "value":a=
a.data[b];break;case "label":a=this.chart.config.data.labels[b];break;case "image":a=this.options.images[b]?this.loadImage(this.options.images[b]):"";break;default:a=this.getPercentage(a,c,b)+"%"}"object"===typeof a?a=this.loadImage(a):null!==a&&void 0!==a&&(a=a.toString());return a};f.prototype.getFontColor=function(a,c,b){var d=this.options.fontColor;"function"===typeof d?d=d({label:this.chart.config.data.labels[b],value:a.data[b],percentage:this.getPercentage(a,c,b),backgroundColor:a.backgroundColor[b],
dataset:a,index:b}):"string"!==typeof d&&(d=d[b]||this.chart.config.options.defaultFontColor);return d};f.prototype.getPercentage=function(a,c,b){if(null!==this.percentage)return this.percentage;if("polarArea"===this.chart.config.type){if(null===this.total)for(c=this.total=0;c<a.data.length;++c)this.total+=a.data[c];a=a.data[b]/this.total*100}else a=c._view.circumference/this.chart.config.options.circumference*100;a=parseFloat(a.toFixed(this.options.precision));this.options.showActualPercentages||
(this.totalPercentage+=a,100<this.totalPercentage&&(a-=this.totalPercentage-100,a=parseFloat(a.toFixed(this.options.precision))));return this.percentage=a};f.prototype.getRenderInfo=function(a,c){return this.options.arc?this.getArcRenderInfo(a,c):this.getBaseRenderInfo(a,c)};f.prototype.getBaseRenderInfo=function(a,c){if("outside"===this.options.position||"border"===this.options.position){var b,d=a._view,e=d.startAngle+(d.endAngle-d.startAngle)/2,g=d.outerRadius/2;"border"===this.options.position?
b=(d.outerRadius-g)/2+g:"outside"===this.options.position&&(b=d.outerRadius-g+g+this.options.textMargin);b={x:d.x+Math.cos(e)*b,y:d.y+Math.sin(e)*b};"outside"===this.options.position&&(e=this.options.textMargin+this.measureLabel(c).width/2,b.x+=b.x<d.x?-e:e);return b}return a.tooltipPosition()};f.prototype.getArcRenderInfo=function(a,c){var b=a._view;var d="outside"===this.options.position?b.outerRadius+this.options.fontSize+this.options.textMargin:"border"===this.options.position?(b.outerRadius/
2+b.outerRadius)/2:(b.innerRadius+b.outerRadius)/2;var e=b.startAngle,g=b.endAngle,h=g-e;e+=Math.PI/2;g+=Math.PI/2;var f=this.measureLabel(c);e+=(g-(f.width/d+e))/2;return{radius:d,startAngle:e,endAngle:g,totalAngle:h,view:b}};f.prototype.drawable=function(a,c,b){if(this.options.overlap)return!0;if(this.options.arc)return b.endAngle-b.startAngle<=b.totalAngle;var d=this.measureLabel(c);c=b.x-d.width/2;var e=b.x+d.width/2,g=b.y-d.height/2;b=b.y+d.height/2;return"outside"===this.options.renderInfo?
this.outsideInRange(c,e,g,b):a.inRange(c,g)&&a.inRange(c,b)&&a.inRange(e,g)&&a.inRange(e,b)};f.prototype.outsideInRange=function(a,c,b,d){for(var e=this.labelBounds,g=0;g<e.length;++g){for(var h=e[g],f=[[a,b],[a,d],[c,b],[c,d]],k=0;k<f.length;++k){var l=f[k][0],m=f[k][1];if(l>=h.left&&l<=h.right&&m>=h.top&&m<=h.bottom)return!1}f=[[h.left,h.top],[h.left,h.bottom],[h.right,h.top],[h.right,h.bottom]];for(k=0;k<f.length;++k)if(l=f[k][0],m=f[k][1],l>=a&&l<=c&&m>=b&&m<=d)return!1}e.push({left:a,right:c,
top:b,bottom:d});return!0};f.prototype.measureLabel=function(a){if("object"===typeof a)return{width:a.width,height:a.height};var c=0;a=a.split("\n");for(var b=0;b<a.length;++b){var d=this.ctx.measureText(a[b]);d.width>c&&(c=d.width)}return{width:c,height:this.options.fontSize*a.length}};f.prototype.loadImage=function(a){var c=new Image;c.src=a.src;c.width=a.width;c.height=a.height;return c};Chart.plugins.register({id:"labels",beforeDatasetsUpdate:function(a,c){if(n.has(a.config.type)){Array.isArray(c)||
(c=[c]);var b=c.length;a._labels&&b===a._labels.length||(a._labels=c.map(function(){return new f}));for(var d=!1,e=0,g=0;g<b;++g){var h=a._labels[g];h.setup(a,c[g]);"outside"===h.options.position&&(d=!0,h=1.5*h.options.fontSize+h.options.outsidePadding,h>e&&(e=h))}d&&(a.chartArea.top+=e,a.chartArea.bottom-=e)}},afterDatasetUpdate:function(a,c,b){n.has(a.config.type)&&a._labels.forEach(function(a){a.elements=c.meta.data})},afterDatasetsDraw:function(a){n.has(a.config.type)&&a._labels.forEach(function(a){a.render()})}})}})();
