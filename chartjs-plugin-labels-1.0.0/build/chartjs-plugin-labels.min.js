/**
 * [chartjs-plugin-labels]{@link https://github.com/emn178/chartjs-plugin-labels}
 *
 * @version 1.0.0
 * @author Chen, Yi-Cyuan [emn178@gmail.com]
 * @copyright Chen, Yi-Cyuan 2017-2018
 * @license MIT
 */
(function(){function f(){this.renderToDataset=this.renderToDataset.bind(this)}"undefined"===typeof Chart?console.error("Can not find Chart object."):(f.prototype.setup=function(a,c,b){this.chart=a;this.elements=c.meta.data;this.ctx=a.ctx;c=a.config.options;this.options=Object.assign({position:"default",precision:0,fontSize:c.defaultFontSize,fontColor:c.defaultFontColor,fontStyle:c.defaultFontStyle,fontFamily:c.defaultFontFamily,shadowOffsetX:3,shadowOffsetY:3,shadowColor:"rgba(0,0,0,0.3)",shadowBlur:6,
images:[],outsidePadding:2,textMargin:2,overlap:!0},b);"outside"===this.options.position&&(b=1.5*this.options.fontSize+this.options.outsidePadding,a.chartArea.top+=b,a.chartArea.bottom-=b)},f.prototype.render=function(){this.labelBounds=[];this.chart.data.datasets.forEach(this.renderToDataset)},f.prototype.renderToDataset=function(a){this.totalPercentage=0;this.total=null;this.elements.forEach(function(c,b){this.renderToElement(a,c,b)}.bind(this))},f.prototype.renderToElement=function(a,c,b){if(this.shouldRenderToElement(c._view)){this.percentage=
null;var d=this.getLabel(a,c,b);if(d){var e=this.getRenderInfo(c,d);if(this.drawable(c,d,e)){var g=this.ctx;g.save();g.beginPath();g.font=Chart.helpers.fontString(this.options.fontSize,this.options.fontStyle,this.options.fontFamily);g.fillStyle=this.getFontColor(a,c,b);this.renderLabel(d,e);g.restore()}}}},f.prototype.renderLabel=function(a,c){return this.options.arc?this.renderArcLabel(a,c):this.renderBaseLabel(a,c)},f.prototype.renderBaseLabel=function(a,c){var b=this.ctx;if("object"===typeof a)b.drawImage(a,
c.x-a.width/2,c.y-a.height/2,a.width,a.height);else{b.save();b.textBaseline="top";b.textAlign="center";this.options.textShadow&&(b.shadowOffsetX=this.options.shadowOffsetX,b.shadowOffsetY=this.options.shadowOffsetY,b.shadowColor=this.options.shadowColor,b.shadowBlur=this.options.shadowBlur);for(var d=a.split("\n"),e=0;e<d.length;e++)b.fillText(d[e],c.x,c.y-this.options.fontSize/2*d.length+this.options.fontSize*e);b.restore()}},f.prototype.renderArcLabel=function(a,c){var b=this.ctx,d=c.radius,e=c.view;
b.save();b.translate(e.x,e.y);if("string"===typeof a){b.rotate(c.startAngle);b.textBaseline="middle";b.textAlign="left";e=a.split("\n");var g=0,f=[],k=0;"border"===this.options.position&&(k=(e.length-1)*this.options.fontSize/2);for(var h=0;h<e.length;++h){var l=b.measureText(e[h]);l.width>g&&(g=l.width);f.push(l.width)}for(h=0;h<e.length;++h){var m=e[h],q=(e.length-1-h)*-this.options.fontSize+k;b.save();b.rotate((g-f[h])/2/d);for(var n=0;n<m.length;n++){var p=m.charAt(n);l=b.measureText(p);b.save();
b.translate(0,-1*d);b.fillText(p,0,q);b.restore();b.rotate(l.width/d)}b.restore()}}else b.rotate((e.startAngle+Math.PI/2+c.endAngle)/2),b.translate(0,-1*d),this.renderLabel(a,{x:0,y:0});b.restore()},f.prototype.shouldRenderToElement=function(a){return this.options.showZero||"polarArea"===this.chart.config.type?0!==a.outerRadius:0!==a.circumference},f.prototype.getLabel=function(a,c,b){if("function"===typeof this.options.render)a=this.options.render({label:this.chart.config.data.labels[b],value:a.data[b],
percentage:this.getPercentage(a,c,b),dataset:a,index:b});else switch(this.options.render){case "value":a=a.data[b];break;case "label":a=this.chart.config.data.labels[b];break;case "image":a=this.options.images[b]?this.loadImage(this.options.images[b]):"";break;default:a=this.getPercentage(a,c,b)+"%"}"object"===typeof a?a=this.loadImage(a):null!==a&&void 0!==a&&(a=a.toString());return a},f.prototype.getFontColor=function(a,c,b){var d=this.options.fontColor;"function"===typeof d?d=d({label:this.chart.config.data.labels[b],
value:a.data[b],percentage:this.getPercentage(a,c,b),backgroundColor:a.backgroundColor[b],dataset:a,index:b}):"string"!==typeof d&&(d=d[b]||this.chart.config.options.defaultFontColor);return d},f.prototype.getPercentage=function(a,c,b){if(null!==this.percentage)return this.percentage;if("polarArea"===this.chart.config.type){if(null===this.total)for(c=this.total=0;c<a.data.length;++c)this.total+=a.data[c];a=a.data[b]/this.total*100}else a=c._view.circumference/this.chart.config.options.circumference*
100;a=parseFloat(a.toFixed(this.options.precision));this.options.showActualPercentages||(this.totalPercentage+=a,100<this.totalPercentage&&(a-=this.totalPercentage-100,a=parseFloat(a.toFixed(this.options.precision))));return this.percentage=a},f.prototype.getRenderInfo=function(a,c){return this.options.arc?this.getArcRenderInfo(a,c):this.getBaseRenderInfo(a,c)},f.prototype.getBaseRenderInfo=function(a,c){if("outside"===this.options.position||"border"===this.options.position){var b,d=a._view,e=d.startAngle+
(d.endAngle-d.startAngle)/2,g=d.outerRadius/2;"border"===this.options.position?b=(d.outerRadius-g)/2+g:"outside"===this.options.position&&(b=d.outerRadius-g+g+this.options.textMargin);b={x:d.x+Math.cos(e)*b,y:d.y+Math.sin(e)*b};"outside"===this.options.position&&(e=this.options.textMargin+this.measureLabel(c).width/2,b.x+=b.x<d.x?-e:e);return b}return a.tooltipPosition()},f.prototype.getArcRenderInfo=function(a,c){var b=a._view;var d="outside"===this.options.position?b.outerRadius+this.options.fontSize+
this.options.textMargin:"border"===this.options.position?(b.outerRadius/2+b.outerRadius)/2:(b.innerRadius+b.outerRadius)/2;var e=b.startAngle,g=b.endAngle,f=g-e;e+=Math.PI/2;g+=Math.PI/2;var k=this.measureLabel(c);e+=(g-(k.width/d+e))/2;return{radius:d,startAngle:e,endAngle:g,totalAngle:f,view:b}},f.prototype.drawable=function(a,c,b){if(this.options.overlap)return!0;if(this.options.arc)return b.endAngle-b.startAngle<=b.totalAngle;var d=this.measureLabel(c);c=b.x-d.width/2;var e=b.x+d.width/2,g=b.y-
d.height/2;b=b.y+d.height/2;return"outside"===this.options.renderInfo?this.outsideInRange(c,e,g,b):a.inRange(c,g)&&a.inRange(c,b)&&a.inRange(e,g)&&a.inRange(e,b)},f.prototype.outsideInRange=function(a,c,b,d){for(var e=this.labelBounds,g=0;g<e.length;++g){for(var f=e[g],k=[[a,b],[a,d],[c,b],[c,d]],h=0;h<k.length;++h){var l=k[h][0],m=k[h][1];if(l>=f.left&&l<=f.right&&m>=f.top&&m<=f.bottom)return!1}k=[[f.left,f.top],[f.left,f.bottom],[f.right,f.top],[f.right,f.bottom]];for(h=0;h<k.length;++h)if(l=k[h][0],
m=k[h][1],l>=a&&l<=c&&m>=b&&m<=d)return!1}e.push({left:a,right:c,top:b,bottom:d});return!0},f.prototype.measureLabel=function(a){if("object"===typeof a)return{width:a.width,height:a.height};var c=0;a=a.split("\n");for(var b=0;b<a.length;++b){var d=this.ctx.measureText(a[b]);d.width>c&&(c=d.width)}return{width:c,height:this.options.fontSize*a.length}},f.prototype.loadImage=function(a){var c=new Image;c.src=a.src;c.width=a.width;c.height=a.height;return c},Chart.plugins.register({id:"labels",afterDatasetUpdate:function(a,
c,b){Array.isArray(b)||(b=[b]);var d=b.length;a._labels&&d===a._labels.length||(a._labels=b.map(function(){return new f}));for(var e=0;e<d;++e)a._labels[e].setup(a,c,b[e])},afterDatasetsDraw:function(a){a._labels.forEach(function(a){a.render()})}}))})();
